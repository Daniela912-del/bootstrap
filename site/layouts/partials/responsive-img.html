{{- /*
  Accepts context, classes, imgPath, alt and lazyload
*/ -}}

{{- $lazy := .lazyload | default true -}}
{{- $classes := slice "img-fluid" "mx-auto" | append (slice .classes) -}}

{{- /* $imageBasePath is the path without the extension */ -}}
{{- $imageBasePath := path.Join "/docs" .context.Site.Params.docs_version (path.Dir .imgPath) -}}
{{- $basename := path.BaseName .imgPath -}}
{{- $ext := path.Ext .imgPath -}}
{{- /* We construct the filenames for the normal and 2x images */ -}}
{{- $imgPath := path.Join $imageBasePath (printf "%s%s" $basename $ext) -}}
{{- $imgPath2x := path.Join $imageBasePath (printf "%s@2x%s" $basename $ext) -}}

{{- with (imageConfig (path.Join "/site/static" $imgPath)) }}
<img class="{{ delimit $classes " " }}"
     srcset="{{ $imgPath }}, {{ $imgPath2x }} 2x"
     src="{{ $imgPath }}"
     alt="{{ $.alt }}"
     width="{{ .Width }}"
     height="{{ .Height }}"
     {{ if eq $lazy true }}loading="lazy"{{ end }}>
{{- end }}
